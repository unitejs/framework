"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const colorHelper_1 = require("./colorHelper");
class ParameterValidation {
    static checkPackageName(logger, name, value) {
        // Rules from here https://docs.npmjs.com/files/package.json
        // here https://github.com/npm/validate-npm-package-name
        // and here https://github.com/npm/npm-registry-couchapp/
        // blob/b31793881ff95c5bca5966a0a8bf8e5f7a801247/registry/modules.js#L93
        if (value === undefined || value === null || value.length === 0) {
            logger.error(name, "parameter is missing.");
            return false;
        }
        if (value.length > 214) {
            logger.error(name, "must be less than or equal to 214 characters.");
            return false;
        }
        if (value.toLowerCase() !== value) {
            logger.error(name, "must not have uppercase letters in it.");
            return false;
        }
        if (value[0] === "." || value[0] === "-" || value[0] === "_") {
            logger.error(name, "must not start with a dot, hyphen or underscore.");
            return false;
        }
        if (value.match(/[\/\\\(\)&\?#\|<>@:%\s\*'"!~`]/)) {
            logger.error(name, "must not have any special characters.");
            return false;
        }
        if (encodeURIComponent(value) !== value) {
            logger.error(name, "can't contain any non-URL-safe characters.");
            return false;
        }
        logger.info(name, { value });
        return true;
    }
    static checkPattern(logger, name, value, pattern, patternExplain) {
        if (value === undefined || value === null || value.length === 0) {
            logger.error(name, "parameter is missing.");
            return false;
        }
        if (pattern === undefined || pattern === null) {
            logger.error(name, "pattern is missing.");
            return false;
        }
        if (!pattern.test(value)) {
            logger.error(name, `does not match pattern ${patternExplain}.`);
            return false;
        }
        logger.info(name, { value });
        return true;
    }
    static checkOneOf(logger, name, value, values, error) {
        if (value === undefined || value === null || value.length === 0) {
            logger.error(name, "parameter is missing.");
            return false;
        }
        if (values === undefined || values === null || values.length === 0) {
            logger.error(name, "values are missing.");
            return false;
        }
        if (values.indexOf(value) === -1) {
            if (error) {
                logger.error(name, error);
            }
            else {
                logger.error(name, `does not match any of the possible values. [${values.join(",")}]`);
            }
            return false;
        }
        logger.info(name, { value });
        return true;
    }
    static notEmpty(logger, name, value) {
        if (value === undefined || value === null || value.length === 0) {
            logger.error(name, "parameter is missing.");
            return false;
        }
        logger.info(name, { value });
        return true;
    }
    static notEmptyNumber(logger, name, value) {
        if (value === undefined || value === null) {
            logger.error(name, "parameter is missing.");
            return false;
        }
        if (value <= 0) {
            logger.error(name, "must be greater than zero.");
            return false;
        }
        logger.info(name, { value });
        return true;
    }
    static isColor(logger, name, value) {
        if (value === undefined || value === null || value.length === 0) {
            logger.error(name, "parameter is missing.");
            return false;
        }
        if (!colorHelper_1.ColorHelper.isHex(value)) {
            logger.error(name, "is not a hex color.");
            return false;
        }
        logger.info(name, { value });
        return true;
    }
}
exports.ParameterValidation = ParameterValidation;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oZWxwZXJzL3BhcmFtZXRlclZhbGlkYXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFJQSwrQ0FBNEM7QUFFNUM7SUFDVyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsTUFBZSxFQUFFLElBQVksRUFBRSxLQUFnQztRQUMxRiw0REFBNEQ7UUFDNUQsd0RBQXdEO1FBQ3hELHlEQUF5RDtRQUN6RCx3RUFBd0U7UUFDeEUsSUFBSSxLQUFLLEtBQUssU0FBUyxJQUFJLEtBQUssS0FBSyxJQUFJLElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDN0QsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsdUJBQXVCLENBQUMsQ0FBQztZQUM1QyxPQUFPLEtBQUssQ0FBQztTQUNoQjtRQUVELElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLEVBQUU7WUFDcEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsK0NBQStDLENBQUMsQ0FBQztZQUNwRSxPQUFPLEtBQUssQ0FBQztTQUNoQjtRQUVELElBQUksS0FBSyxDQUFDLFdBQVcsRUFBRSxLQUFLLEtBQUssRUFBRTtZQUMvQixNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSx3Q0FBd0MsQ0FBQyxDQUFDO1lBQzdELE9BQU8sS0FBSyxDQUFDO1NBQ2hCO1FBRUQsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsRUFBRTtZQUMxRCxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxrREFBa0QsQ0FBQyxDQUFDO1lBQ3ZFLE9BQU8sS0FBSyxDQUFDO1NBQ2hCO1FBRUQsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLGdDQUFnQyxDQUFDLEVBQUU7WUFDL0MsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUs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N0IsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztDQUNKO0FBaklELGtEQWlJQyIsImZpbGUiOiJoZWxwZXJzL3BhcmFtZXRlclZhbGlkYXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBhcmFtZXRlciB2YWxpZGF0aW9uLlxuICovXG5pbXBvcnQgeyBJTG9nZ2VyIH0gZnJvbSBcIi4uL2ludGVyZmFjZXMvSUxvZ2dlclwiO1xuaW1wb3J0IHsgQ29sb3JIZWxwZXIgfSBmcm9tIFwiLi9jb2xvckhlbHBlclwiO1xuXG5leHBvcnQgY2xhc3MgUGFyYW1ldGVyVmFsaWRhdGlvbiB7XG4gICAgcHVibGljIHN0YXRpYyBjaGVja1BhY2thZ2VOYW1lKGxvZ2dlcjogSUxvZ2dlciwgbmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgdW5kZWZpbmVkIHwgbnVsbCk6IGJvb2xlYW4ge1xuICAgICAgICAvLyBSdWxlcyBmcm9tIGhlcmUgaHR0cHM6Ly9kb2NzLm5wbWpzLmNvbS9maWxlcy9wYWNrYWdlLmpzb25cbiAgICAgICAgLy8gaGVyZSBodHRwczovL2dpdGh1Yi5jb20vbnBtL3ZhbGlkYXRlLW5wbS1wYWNrYWdlLW5hbWVcbiAgICAgICAgLy8gYW5kIGhlcmUgaHR0cHM6Ly9naXRodWIuY29tL25wbS9ucG0tcmVnaXN0cnktY291Y2hhcHAvXG4gICAgICAgIC8vIGJsb2IvYjMxNzkzODgxZmY5NWM1YmNhNTk2NmEwYThiZjhlNWY3YTgwMTI0Ny9yZWdpc3RyeS9tb2R1bGVzLmpzI0w5M1xuICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihuYW1lLCBcInBhcmFtZXRlciBpcyBtaXNzaW5nLlwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAyMTQpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihuYW1lLCBcIm11c3QgYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIDIxNCBjaGFyYWN0ZXJzLlwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh2YWx1ZS50b0xvd2VyQ2FzZSgpICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG5hbWUsIFwibXVzdCBub3QgaGF2ZSB1cHBlcmNhc2UgbGV0dGVycyBpbiBpdC5cIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodmFsdWVbMF0gPT09IFwiLlwiIHx8IHZhbHVlWzBdID09PSBcIi1cIiB8fCB2YWx1ZVswXSA9PT0gXCJfXCIpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihuYW1lLCBcIm11c3Qgbm90IHN0YXJ0IHdpdGggYSBkb3QsIGh5cGhlbiBvciB1bmRlcnNjb3JlLlwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh2YWx1ZS5tYXRjaCgvW1xcL1xcXFxcXChcXCkmXFw/I1xcfDw+QDolXFxzXFwqJ1wiIX5gXS8pKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IobmFtZSwgXCJtdXN0IG5vdCBoYXZlIGFueSBzcGVjaWFsIGNoYXJhY3RlcnMuXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IobmFtZSwgXCJjYW4ndCBjb250YWluIGFueSBub24tVVJMLXNhZmUgY2hhcmFjdGVycy5cIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBsb2dnZXIuaW5mbyhuYW1lLCB7IHZhbHVlIH0pO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgY2hlY2tQYXR0ZXJuKGxvZ2dlcjogSUxvZ2dlciwgbmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgdW5kZWZpbmVkIHwgbnVsbCwgcGF0dGVybjogUmVnRXhwLCBwYXR0ZXJuRXhwbGFpbjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsIHx8IHZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG5hbWUsIFwicGFyYW1ldGVyIGlzIG1pc3NpbmcuXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhdHRlcm4gPT09IHVuZGVmaW5lZCB8fCBwYXR0ZXJuID09PSBudWxsKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IobmFtZSwgXCJwYXR0ZXJuIGlzIG1pc3NpbmcuXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFwYXR0ZXJuLnRlc3QodmFsdWUpKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IobmFtZSwgYGRvZXMgbm90IG1hdGNoIHBhdHRlcm4gJHtwYXR0ZXJuRXhwbGFpbn0uYCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBsb2dnZXIuaW5mbyhuYW1lLCB7IHZhbHVlIH0pO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgY2hlY2tPbmVPZjxUIGV4dGVuZHMgc3RyaW5nPihsb2dnZXI6IElMb2dnZXIsIG5hbWU6IHN0cmluZywgdmFsdWU6IFQgfCB1bmRlZmluZWQgfCBudWxsLCB2YWx1ZXM6IFRbXSwgZXJyb3I/OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IobmFtZSwgXCJwYXJhbWV0ZXIgaXMgbWlzc2luZy5cIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodmFsdWVzID09PSB1bmRlZmluZWQgfHwgdmFsdWVzID09PSBudWxsIHx8IHZhbHVlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihuYW1lLCBcInZhbHVlcyBhcmUgbWlzc2luZy5cIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodmFsdWVzLmluZGV4T2YodmFsdWUpID09PSAtMSkge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG5hbWUsIGVycm9yKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG5hbWUsIGBkb2VzIG5vdCBtYXRjaCBhbnkgb2YgdGhlIHBvc3NpYmxlIHZhbHVlcy4gWyR7dmFsdWVzLmpvaW4oXCIsXCIpfV1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvZ2dlci5pbmZvKG5hbWUsIHsgdmFsdWUgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBub3RFbXB0eShsb2dnZXI6IElMb2dnZXIsIG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IHN0cmluZ1tdIHwgdW5kZWZpbmVkIHwgbnVsbCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihuYW1lLCBcInBhcmFtZXRlciBpcyBtaXNzaW5nLlwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvZ2dlci5pbmZvKG5hbWUsIHsgdmFsdWUgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBub3RFbXB0eU51bWJlcihsb2dnZXI6IElMb2dnZXIsIG5hbWU6IHN0cmluZywgdmFsdWU6IG51bWJlciB8IHVuZGVmaW5lZCB8IG51bGwpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihuYW1lLCBcInBhcmFtZXRlciBpcyBtaXNzaW5nLlwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh2YWx1ZSA8PSAwKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IobmFtZSwgXCJtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvLlwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvZ2dlci5pbmZvKG5hbWUsIHsgdmFsdWUgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBpc0NvbG9yKGxvZ2dlcjogSUxvZ2dlciwgbmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgdW5kZWZpbmVkIHwgbnVsbCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihuYW1lLCBcInBhcmFtZXRlciBpcyBtaXNzaW5nLlwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghQ29sb3JIZWxwZXIuaXNIZXgodmFsdWUpKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IobmFtZSwgXCJpcyBub3QgYSBoZXggY29sb3IuXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgbG9nZ2VyLmluZm8obmFtZSwgeyB2YWx1ZSB9KTtcblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG4iXX0=
